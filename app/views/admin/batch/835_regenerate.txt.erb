ISA*00*          *00*          *ZZ*<%= @payer_new.supply_payid.ljust(15)%>*ZZ*ANODYNE        *<%= Time.now().strftime("%y%m%d")%>*<%= Time.now().strftime("%H%M") %>*U*00401*<%= sprintf("%09d",id_835)%>*0*P*:~
GS*HP*<%= @payer_new.supply_payid%>*ANODYNE*<%= Time.now().strftime("%Y%m%d")%>*<%= Time.now().strftime("%H%M") %>*2831*X*004010X091A1~<%total_check_amount=0%><% @check_infns.each_with_index do|chk_info,i| %><%if !chk_info.check_amount.blank?%><%total_check_amount+=chk_info.check_amount%><%end%><%end%>
<%@chk_info=@check_infns[0]%><%i1=0%>
ST*835*<%= sprintf("%04d", offset + i1 + 1)%>~<%count=1%>
BPR*I*<%if !total_check_amount.blank?%><%= split_decimal(total_check_amount.to_s.strip)%><%end%>*C*CHK************<% if !@chk_info.check_date.blank?%><%=@chk_info.check_date.to_s.strip.split("-")%><%end%>~<% count=count+1%>
TRN*1*<%if !@payer_new.payer.blank? and !@deposit_date.blank?%><%=@payer_new.payer.strip.slice(0,21)%>_<%=@deposit_date.to_s.strip.split("-")%>_<%=@batch_id_output.strip.split("_").last%><%end%>*1<% if !@chk_info.payer_tin.blank?%><%=@chk_info.payer_tin.strip%><%else%>999999999<%end%>~<% count=count+1%>
DTM*405*<% if !@chk_info.check_date.blank?%><%=@chk_info.check_date.to_s.strip.split("-")%><%else%><%= Time.now().strftime("%Y%m%d")%><%end%>~<% count=count+1%>
<%if !@payer_new.payer.blank?%>N1*PR*<%=@payer_new.payer.strip.slice(0,60)%>~<% count=count+1%><%end%>
<% if !@payer_new.pay_address_one.blank? or (!@payer_new.pay_address_two.blank? and @payer_new.pay_address_two.strip!="NOT PROVIDED")%>
N3*<% if !@payer_new.pay_address_one.blank?%><%=@payer_new.pay_address_one.strip%><%end%><% if !@payer_new.pay_address_two.blank? and @payer_new.pay_address_two.strip!="NOT PROVIDED"%>*<%=@payer_new.pay_address_two.strip%><%end%>~<% count=count+1%>
<%end%>
<% if !@payer_new.payer_city.blank? or !@payer_new.payer_state.blank? or !@payer_new.payer_zip.blank? %>
N4*<% if !@payer_new.payer_city.blank?%><%=@payer_new.payer_city.strip%><%end%><%if !@payer_new.payer_state.blank? or !@payer_new.payer_zip.blank? %>*<% if !@payer_new.payer_state.blank?%><%=@payer_new.payer_state.strip%><%end%><%end%><% if !@payer_new.payer_zip.blank?%>*<%=@payer_new.payer_zip.to_s.strip%><%end%>~<% count=count+1%>
<%end%>
<%if !@chk_info.payee_name.blank? %><% if @payee=="PEMA" %><%payee_npi = 1801822523 %><%else%><% if @payee=="HSS"%><%payee_npi = 1134139116%><%end%><%if @payee.upcase=="INTERNAL MEDICINE SPECIALISTS"%><%payee_npi = 1326079567%><%end%><%end%>
N1*PE*<% if !@chk_info.payee_name.blank?%><%= @chk_info.payee_name.strip.slice(0,60)%><%end%>*XX*<%= payee_npi%>~<% count=count+1%>
<%end%>
<% if @payee=="PEMA" %>
N3*PO BOX 37905~<% count=count+1%>
N4*Charlotte*NC*282377805~<% count=count+1%>
<%else%>
<% if @payee=="HSS"%>
N3*GPO BOX 5058~<% count=count+1%>
N4*New York*NY*10087~<% count=count+1%>
<%end%>
<%if @payee.upcase=="INTERNAL MEDICINE SPECIALISTS"%>
N3*PO Box 37903~<% count=count+1%>
N4*Charlotte*NC*28237~<% count=count+1%>
<%end%>
<%end%> 
<% if @payee == "PEMA"%><%ref_id= 570724794%><%else%><% if @payee=="HSS"%><%ref_id=131624135%><%end%><%if @payee.upcase=="INTERNAL MEDICINE SPECIALISTS"%><%ref_id=561977185%><%end%><%end%>
REF*TJ*<%= ref_id%>~ <%count=count+1%><%count_lx=0%>
<% @check_infns.each_with_index do|chk_info,i| %>
<%@ins_eobs= chk_info.insurance_payment_eobs%><% @ins_eobs.each_with_index do|ins_eob,j| %>
<%if count_lx>=i+j+1%><%count_lx=count_lx+1%><%else%><%count_lx=i+j+1%><%end%>
LX*<%= count_lx %>~<% count=count+1%>
<%ins_plan_type=0%><%if !ins_eob.plan_type.blank?%><%ins_plan_type=ins_eob.plan_type%><%else%><%ins_plan_type="1"%><%end%>
<%if !ins_eob.patient_account_number.blank?  or !ins_eob.plan_type.blank? or !ins_eob.claim_number.blank? or !chk_info.check_number.blank? or  !ins_eob.total_submitted_charge_for_claim.blank? or !ins_eob.total_amount_paid_for_claim.blank? or !ins_eob.total_co_insurance.blank? or !ins_eob.total_deductible.blank?  or !ins_eob.total_co_pay.blank? or   !ins_eob.claim_number.blank? or !chk_info.check_number.blank? or !ins_eob.drg_code.blank?  or !ins_eob.percent.blank? %>
CLP*<%if !ins_eob.patient_account_number.blank?%><%=ins_eob.patient_account_number.strip%><%else%>0<%end%><%if !ins_eob.claim_type.blank? or !ins_eob.plan_type.blank? or  (!ins_eob.total_submitted_charge_for_claim.blank? and ins_eob.total_submitted_charge_for_claim.to_f>0.0) or (!ins_eob.total_amount_paid_for_claim.blank? and ins_eob.total_amount_paid_for_claim.to_f>0.0) or (!ins_eob.total_co_insurance.blank? and ins_eob.total_co_insurance.to_f>0.0) or (!ins_eob.total_deductible.blank? and ins_eob.total_deductible.to_f>0.0)  or (!ins_eob.total_co_pay.blank? and ins_eob.total_co_pay.to_f>0.0) or !ins_eob.claim_number.blank? or !chk_info.check_number.blank? or !ins_eob.drg_code.blank?  or (!ins_eob.percent.blank? and ins_eob.percent.to_f>0.0)%>*<% if !ins_eob.claim_type.blank?%><%=ins_eob.claim_type_code.to_s.strip%><%end%><%end%><%if (!ins_eob.total_submitted_charge_for_claim.blank? and ins_eob.total_submitted_charge_for_claim.to_f>0.0)or !ins_eob.plan_type.blank? or (!ins_eob.total_amount_paid_for_claim.blank? and ins_eob.total_amount_paid_for_claim.to_f>0.0)or (!ins_eob.total_co_insurance.blank? and ins_eob.total_co_insurance.to_f>0.0) or (!ins_eob.total_deductible.blank? and ins_eob.total_deductible.to_f>0.0)  or (!ins_eob.total_co_pay.blank? and ins_eob.total_co_pay.to_f>0.0)  or !ins_eob.claim_number.blank? or !chk_info.check_number.blank? or !ins_eob.drg_code.blank?  or (!ins_eob.percent.blank? and ins_eob.percent.to_f>0.0)%>*<% if !ins_eob.total_submitted_charge_for_claim.blank? and ins_eob.total_submitted_charge_for_claim.to_f>0.0%><%=split_decimal(ins_eob.total_submitted_charge_for_claim.to_s.strip)%><%end%><%end%><%if (!ins_eob.total_amount_paid_for_claim.blank? and ins_eob.total_amount_paid_for_claim.to_f>0.0) or !ins_eob.plan_type.blank? or (!ins_eob.total_co_insurance.blank? and ins_eob.total_co_insurance.to_f>0.0) or (!ins_eob.total_deductible.blank? and ins_eob.total_deductible.to_f>0.0)  or (!ins_eob.total_co_pay.blank? and ins_eob.total_co_pay.to_f>0.0)or !ins_eob.claim_number.blank? or !chk_info.check_number.blank? or !ins_eob.drg_code.blank?  or (!ins_eob.percent.blank? and ins_eob.percent.to_f>0.0) %>*<%if !ins_eob.total_amount_paid_for_claim.blank? and ins_eob.total_amount_paid_for_claim.to_f>0.0 and ins_eob.claim_type_code.to_s!="4"%><%=split_decimal(ins_eob.total_amount_paid_for_claim.to_s.strip)%><%else%>0<%end%><%end%><%if (!ins_eob.total_co_insurance.blank? and ins_eob.total_co_insurance.to_f>0.0) or (!ins_eob.total_deductible.blank? and ins_eob.total_deductible.to_f>0.0)  or (!ins_eob.total_co_pay.blank? and ins_eob.total_co_pay.to_f>0.0)  or !ins_eob.claim_number.blank? or !chk_info.check_number.blank? or (!ins_eob.drg_code.blank? and ins_eob.drg_code.to_f>0.0)  or (!ins_eob.percent.blank? and ins_eob.percent>0.0) or !ins_eob.plan_type.blank? %>*<%sum=0%><%if !ins_eob.total_co_insurance.blank? and ins_eob.total_co_insurance.to_f>0.0%><%sum+=ins_eob.total_co_insurance%><%end%><%if !ins_eob.total_deductible.blank? and ins_eob.total_deductible.to_f>0.0%><%sum+=ins_eob.total_deductible%><%end%><%if !ins_eob.total_co_pay.blank? and ins_eob.total_co_pay.to_f>0.0%><%sum+=ins_eob.total_co_pay%><%end%><% if !sum.blank? and sum.to_f>0.0 %><%= split_decimal(sum.to_s) %><%end%><%end%><%if !ins_eob.claim_number.blank? or !chk_info.check_number.blank? or !ins_eob.drg_code.blank?  or (!ins_eob.percent.blank? and ins_eob.percent.to_f>0.0) or !ins_eob.plan_type.blank?%>*<%if !ins_eob.plan_type.blank?%><%= ins_eob.type_of_plan%><%end%><%end%><%if !ins_eob.claim_number.blank? or !chk_info.check_number.blank? or !ins_eob.drg_code.blank?  or (!ins_eob.percent.blank? and ins_eob.percent.to_f>0.0)%>*<%if !ins_eob.claim_number.blank? or !chk_info.check_number.blank?%><%if !chk_info.check_number.blank?%><%=chk_info.check_number.to_s.strip%>_<%end%><%if !ins_eob.claim_number.blank?%><%=ins_eob.claim_number.to_s.strip%><%end%><%end%><%end%><%if !ins_eob.drg_code.blank?  or (!ins_eob.percent.blank? and ins_eob.percent.to_f>0.0)%>**<%if !ins_eob.drg_code.blank?%><%= ins_eob.drg_code.to_s.strip %><%end%><%end%><%if  !ins_eob.drg_weight.blank?  or (!ins_eob.percent.blank? and ins_eob.percent.to_f>0.0) %>*<%if !ins_eob.drg_weight.blank?%><%=split_decimal(ins_eob.drg_weight.to_s.strip)%><%end%><%end%><%if !ins_eob.percent.blank? and ins_eob.percent.to_f>0.0%>*<%=split_decimal(ins_eob.percent.to_s.strip)%><%end%>~<% count=count+1%>
<%end%>
<%if (!ins_eob.claim_deductuble_groupcode.blank? and ins_eob.claim_deductuble_groupcode.strip=="PR" and  !ins_eob.total_deductible.blank? and ins_eob.total_deductible>0.0 and !ins_eob.claim_deductable_reasoncode.blank?) or (!ins_eob.claim_copay_groupcode.blank? and ins_eob.claim_copay_groupcode.strip=="PR" and !ins_eob.total_co_pay.blank? and ins_eob.total_co_pay>0.0 and !ins_eob.claim_copay_reasoncode.blank?) or (!ins_eob.claim_coinsurance_groupcode.blank? and ins_eob.claim_coinsurance_groupcode.strip=="PR" and !ins_eob.total_co_insurance.blank? and ins_eob.total_co_insurance>0.0 and !ins_eob.claim_coinsurance_reasoncode.blank?)%>CAS*<%co_insurance=0%><%co_pay = 0%><%deducatble=0%><%if (!ins_eob.claim_coinsurance_groupcode.blank? and ins_eob.claim_coinsurance_groupcode.strip=="PR") and (!ins_eob.total_co_insurance.blank? and ins_eob.total_co_insurance>0.0) and !ins_eob.claim_coinsurance_reasoncode.blank?%><%=ins_eob.claim_coinsurance_groupcode.strip%>*<%=ins_eob.claim_coinsurance_reasoncode.strip%>*<%=split_decimal(ins_eob.total_co_insurance.to_s.strip)%><%co_insurance=1%><%end%><%if (!ins_eob.claim_deductuble_groupcode.blank? and ins_eob.claim_deductuble_groupcode.strip=="PR" and  !ins_eob.total_deductible.blank? and ins_eob.total_deductible>0.0 and !ins_eob.claim_deductable_reasoncode.blank? )%><%if co_insurance==1%>**<%else%><%=ins_eob.claim_deductuble_groupcode.strip%>*<%end%><%=ins_eob.claim_deductable_reasoncode.strip%>*<%=split_decimal(ins_eob.total_deductable.to_s.strip)%><%deductable=1%><%end%><%if (!ins_eob.claim_copay_groupcode.blank? and ins_eob.claim_copay_groupcode.strip=="PR" and !ins_eob.total_co_pay.blank? and ins_eob.total_co_pay>0.0 and !ins_eob.claim_copay_reasoncode.blank?) %><%if co_insurance==1 or deducatble==1%>**<%else%><%=ins_eob.claim_copay_groupcode.strip%>*<%end%><%=ins_eob.service_claim_copay_reasoncode%>*<%=split_decimal(ins_eob.total_co_pay.to_s.strip)%><%end%>~<%count=count+1%><%end%>
<%if (!ins_eob.claim_charge_groupcode.blank? and ins_eob.claim_charge_groupcode.strip!=".." and !ins_eob.claim_charges_reasoncode.blank? and !ins_eob.total_submitted_charge_for_claim.blank? and ins_eob.total_submitted_charge_for_claim>0.0) or (!ins_eob.claim_noncovered_groupcode.blank? and ins_eob.claim_noncovered_groupcode!=".." and !ins_eob.claim_noncovered_reasoncode.blank? and !ins_eob.total_non_covered.blank? and ins_eob.total_non_covered>0.0) or (!ins_eob.claim_discount_groupcode.blank? and ins_eob.claim_discount_groupcode!=".." and  !ins_eob.claim_discount_reasoncode.blank? and !ins_eob.total_discount.blank? and ins_eob.total_discount>0.0) or (!ins_eob.claim_contractual_groupcode.blank? and ins_eob.claim_contractual_groupcode!=".." and !ins_eob.claim_contractual_reasoncode.blank? and !ins_eob.total_contractual_amount.blank? and ins_eob.total_contractual_amount>0.0) or (!ins_eob.claim_payment_groupcode.blank? and ins_eob.claim_payment_groupcode!=".." and !ins_eob.claim_payment_reasoncode.blank? and !ins_eob.total_amount_paid_for_claim.blank? and ins_eob.total_amount_paid_for_claim>0.0) or (!ins_eob.claim_primary_payment_groupcode.blank? and ins_eob.claim_primary_payment_groupcode!=".." and !ins_eob.claim_primary_payment_reasoncode.blank? and !ins_eob.total_primary_payer_amount.blank? and ins_eob.total_primary_payer_amount>0.0) %><%charges=0%><%noncovered=0%><%discount=0%><%contractual=0%><%payment=0%><%primary_payment=0%>
CAS*<%if (!ins_eob.claim_charge_groupcode.blank? and ins_eob.claim_charge_groupcode.strip!=".." and !ins_eob.claim_charges_reasoncode.blank? and !ins_eob.total_submitted_charge_for_claim.blank? and ins_eob.total_submitted_charge_for_claim>0.0)%><%=ins_eob.claim_charge_groupcode.strip%>*<%=ins_eob.claim_charges_reasoncode.strip%>*<%=split_decimal(ins_eob.total_submitted_charge_for_claim.to_s.strip)%><%charges=1%><%end%><%if (!ins_eob.claim_noncovered_groupcode.blank? and ins_eob.claim_noncovered_groupcode.strip!=".." and !ins_eob.claim_noncovered_reasoncode.blank? and !ins_eob.total_non_covered.blank? and ins_eob.total_non_covered>0.0)%><%if charges==1%>**<%else%><%=ins_eob.claim_noncovered_groupcode.strip%>*<%end%><%=ins_eob.claim_noncovered_reasoncode%>*<%=split_decimal(ins_eob.total_non_covered.to_s.strip)%><%noncovered=1%><%end%><% if (!ins_eob.claim_discount_groupcode.blank? and ins_eob.claim_discount_groupcode.strip!=".." and  !ins_eob.claim_discount_reasoncode.blank? and !ins_eob.total_discount.blank? and ins_eob.total_discount>0.0) %><%if charges==1 or noncovered==1%>**<%else%><%=ins_eob.claim_discount_groupcode.strip%>*<%end%><%=ins_eob.claim_discount_reasoncode.strip%>*<%=split_decimal(ins_eob.total_discount.to_s.strip)%><%discount=1%><%end%><%if (!ins_eob.claim_contractual_groupcode.blank? and ins_eob.claim_contractual_groupcode.strip!=".." and !ins_eob.claim_contractual_reasoncode.blank? and !ins_eob.total_contractual_amount.blank? and ins_eob.total_contractual_amount>0.0) %><%if charges==1 or noncovered==1 or discount==1%>**<%else%><%=ins_eob.claim_contractual_groupcode.strip%>*<%end%><%=ins_eob.claim_contractual_reasoncode.strip%>*<%=split_decimal(ins_eob.total_contractual_amount.to_s.strip)%><%contractual=1%><%end%><%if (!ins_eob.claim_payment_groupcode.blank? and ins_eob.claim_payment_groupcode.strip!=".." and !ins_eob.claim_payment_reasoncode.blank? and !ins_eob.total_amount_paid_for_claim.blank? and ins_eob.total_amount_paid_for_claim>0.0)%><%if charges==1 or noncovered==1 or discount==1 or contractual==1%>**<%else%><%=ins_eob.claim_payment_groupcode.strip%>*<%end%><%=ins_eob.claim_payment_reasoncode%>*<%=split_decimal(ins_eob.total_amount_paid_for_claim.to_s.strip)%><%payment=1%><%end%><%if (!ins_eob.claim_primary_payment_groupcode.blank? and ins_eob.claim_primary_payment_groupcode.strip!=".." and !ins_eob.claim_primary_payment_reasoncode.blank? and !ins_eob.total_primary_payer_amount.blank? and ins_eob.total_primary_payer_amount>0.0) %><%if charges==1 or noncovered==1 or discount==1 or contractual==1 or payment==1%>**<%else%><%=ins_eob.claim_primary_payment_groupcode.strip%>*<%end%><%=ins_eob.claim_primary_payment_reasoncode.strip%><%=split_decimal(ins_eob.total_primary_payer_amount.to_s.strip)%><%end%>~<%count=count+1%>
<%end%>
<%if !ins_eob.patient_last_name.blank? or  !ins_eob.patient_first_name.blank? or !ins_eob.patient_middle_initial.blank? or !ins_eob.patient_suffix.blank? or (!ins_eob.patient_identification_code_qualifier.blank? and ins_eob.patient_identification_code_qualifier!="--")or !ins_eob.subscriber_identification_code.blank? or !ins_eob.patient_identification_code.blank?%>
NM1*QC*1*<%if !ins_eob.patient_last_name.blank?%><%=ins_eob.patient_last_name.to_s.strip%><%end%><%if !ins_eob.patient_first_name.blank? or !ins_eob.patient_middle_initial.blank? or !ins_eob.patient_suffix.blank? or (!ins_eob.patient_identification_code_qualifier.blank? and ins_eob.patient_identification_code_qualifier!="--") or !ins_eob.subscriber_identification_code.blank? or !ins_eob.patient_identification_code.blank?%>*<%if !ins_eob.patient_first_name.blank?%><%=ins_eob.patient_first_name.to_s.strip%><%end%><%end%><% if !ins_eob.patient_middle_initial.blank? or !ins_eob.patient_suffix.blank? or (!ins_eob.patient_identification_code_qualifier.blank? and ins_eob.patient_identification_code_qualifier!="--") or !ins_eob.subscriber_identification_code.blank? or !ins_eob.patient_identification_code.blank?%>*<%if !ins_eob.patient_middle_initial.blank?%><%=ins_eob.patient_middle_initial.to_s.strip%><%end%><%end%><%if !ins_eob.patient_suffix.blank? or (!ins_eob.patient_identification_code_qualifier.blank? and ins_eob.patient_identification_code_qualifier!="--" and !ins_eob.patient_identification_code.blank? and (ins_eob.patient_identification_code_qualifier.strip=="SSN" or ins_eob.patient_identification_code_qualifier.strip=="HIC")) or !ins_eob.patient_identification_code.blank? %>**<%if !ins_eob.patient_suffix.blank?%><%=ins_eob.patient_suffix.to_s.strip%><%end%><%end%><%if !ins_eob.subscriber_identification_code.blank? or !ins_eob.patient_identification_code.blank? or  (!ins_eob.patient_identification_code_qualifier.blank? and  ins_eob.patient_identification_code_qualifier!="--")%><%if  !ins_eob.patient_identification_code_qualifier.blank? and ins_eob.patient_identification_code_qualifier!="--"%><%if ins_eob.patient_identification_code_qualifier.strip!="SSN" and ins_eob.patient_identification_code_qualifier.strip!="HIC"%><%if !ins_eob.patient_identification_code.blank?%>*MI*<%=ins_eob.patient_identification_code.to_s.strip%><%end%><%else%><%if !ins_eob.patient_identification_code.blank?%>*<%=ins_eob.identification_code_qual%>*<%=ins_eob.patient_identification_code.strip%><%end%><%end%><%end%><%end%>~<% count=count+1%>
<%end%>
<%if !ins_eob.subscriber_last_name.blank? or  !ins_eob.subscriber_first_name.blank? or !ins_eob.subscriber_middle_initial.blank? or !ins_eob.subscriber_suffix.blank? or !ins_eob.subscriber_identification_code_qualifier.blank? or !ins_eob.subscriber_identification_code.blank?%>
<% if ins_eob.patient_last_name != ins_eob.subscriber_last_name and ins_eob.patient_first_name != ins_eob.subscriber_first_name%>
NM1*IL*1*<%if !ins_eob.subscriber_last_name.blank?%><%= ins_eob.subscriber_last_name.strip%><%end%><%if !ins_eob.subscriber_first_name.blank? or !ins_eob.subscriber_middle_initial.blank? or !ins_eob.subscriber_suffix.blank? or !ins_eob.subscriber_identification_code_qualifier.blank? or !ins_eob.subscriber_identification_code.blank?%>*<%if !ins_eob.subscriber_first_name.blank?%><%= ins_eob.subscriber_first_name.strip%><%end%><%end%><%if !ins_eob.subscriber_middle_initial.blank? or !ins_eob.subscriber_suffix.blank? or !ins_eob.subscriber_identification_code_qualifier.blank? or !ins_eob.subscriber_identification_code.blank?%>*<%if !ins_eob.subscriber_middle_initial.blank?%><%= ins_eob.subscriber_middle_initial.strip%><%end%><%end%><%if !ins_eob.subscriber_suffix.blank? or !ins_eob.subscriber_identification_code_qualifier.blank? or !ins_eob.subscriber_identification_code.blank?%>**<%if !ins_eob.subscriber_suffix.blank?%><%= ins_eob.subscriber_suffix.strip%><%end%><%end%><%if !ins_eob.subscriber_identification_code_qualifier.blank? or !ins_eob.subscriber_identification_code.blank?%>*MI<%end%><%if !ins_eob.subscriber_identification_code.blank?%>*<%= ins_eob.subscriber_identification_code.strip%><%end%>~<% count=count+1%>
<%end%>
<%end%>
<% if !ins_eob.rendering_provider_last_name.blank? or  !ins_eob.rendering_provider_first_name.blank? or !ins_eob.rendering_provider_middle_initial.blank? or !ins_eob.rendering_provider_suffix.blank? %>
NM1*82*1*<% if !ins_eob.rendering_provider_last_name.blank?%><%= ins_eob.rendering_provider_last_name.to_s.strip%><%end%><% if !ins_eob.rendering_provider_first_name.blank? or !ins_eob.rendering_provider_middle_initial.blank? or !ins_eob.rendering_provider_suffix.blank? or !ins_eob.rendering_provider_code_qualifier.blank? or !ins_eob.provider_tin.blank?%>*<% if !ins_eob.rendering_provider_first_name.blank?%><%= ins_eob.rendering_provider_first_name.to_s.strip%><%end%><%end%><% if !ins_eob.rendering_provider_middle_initial.blank? or !ins_eob.rendering_provider_suffix.blank? or !ins_eob.rendering_provider_code_qualifier.blank? or !ins_eob.provider_tin.blank?%>*<% if !ins_eob.rendering_provider_middle_initial.blank?%><%= ins_eob.rendering_provider_middle_initial.to_s.strip%><%end%><%end%><% if !ins_eob.rendering_provider_suffix.blank? or !ins_eob.rendering_provider_code_qualifier.blank? or !ins_eob.provider_tin.blank?%>**<% if !ins_eob.rendering_provider_suffix.blank? and ins_eob.rendering_provider_suffix.upcase!="MD"%><%= ins_eob.rendering_provider_suffix.to_s.strip%><%end%><%end%>*FI<%if @payee=="PEMA"%>*570724794<%else%><% if !ins_eob.provider_tin.blank?%>*<%= ins_eob.provider_tin.to_s.strip%><%end%><%end%>~<% count=count+1%>
<%else%>
NM1*82*2*PIEDMONT EMERGENCY MEDICINE*****FI*570724794~<% count=count+1%>
<%end%>
<%if !ins_eob.insurance_policy_number.blank?%>
REF*IG*<%=ins_eob.insurance_policy_number.strip%>~<% count=count+1%>
<%end%>
<%if !ins_eob.claim_interest.blank? and ins_eob.claim_interest>0 %>AMT*I*<%=split_decimal(ins_eob.claim_interest.to_s.strip)%>~<%count=count+1%><%end%>
<% @servicepaymenteobs= ins_eob.service_payment_eobs%> <%@servicepaymenteobs.each_with_index do|service_eob,k|%>
<%if !service_eob.service_procedure_code.blank? or !service_eob.service_modifier1.blank? or !service_eob.service_modifier2.blank? or !service_eob.service_modifier3.blank? or !service_eob.service_modifier4.blank? or !service_eob.service_procedure_charge_amount.blank? or !service_eob.service_paid_amount.blank? or !service_eob.service_quantity.blank?%>
SVC*HC<% a=":" %><%=a%><%if !service_eob.service_procedure_code.blank?%><%= service_eob.service_procedure_code.to_s.strip%><%end%><%if !service_eob.service_modifier1.blank? or !service_eob.service_modifier2.blank? or !service_eob.service_modifier3.blank? or !service_eob.service_modifier4.blank? or !service_eob.service_procedure_charge_amount.blank? or !service_eob.service_paid_amount.blank? or !service_eob.service_quantity.blank?%><% if !service_eob.service_modifier1.blank?%>:<%= service_eob.service_modifier1.to_s.strip%><%end%><%end%><%if  !service_eob.service_modifier1.blank? or !service_eob.service_modifier2.blank? or !service_eob.service_modifier3.blank? or !service_eob.service_modifier4.blank? or !service_eob.service_procedure_charge_amount.blank? or !service_eob.service_paid_amount.blank? or !service_eob.service_quantity.blank?%><% if !service_eob.service_modifier2.blank?%>:<%= service_eob.service_modifier2.to_s.strip%><%end%><%end%><%if  !service_eob.service_modifier3.blank? or !service_eob.service_modifier4.blank? or !service_eob.service_procedure_charge_amount.blank? or !service_eob.service_paid_amount.blank? or !service_eob.service_quantity.blank?%><% if !service_eob.service_modifier3.blank?%>:<%= service_eob.service_modifier3.to_s.strip%><%end%><%end%><%if  !service_eob.service_modifier4.blank? or !service_eob.service_procedure_charge_amount.blank? or !service_eob.service_paid_amount.blank? or !service_eob.service_quantity.blank?%><% if !service_eob.service_modifier4.blank?%>:<%= service_eob.service_modifier4.to_s.strip%><%end%><%end%><%if  !service_eob.service_procedure_charge_amount.blank? or !service_eob.service_paid_amount.blank? or !service_eob.service_quantity.blank?%>*<% if !service_eob.service_procedure_charge_amount.blank?%><%= split_decimal(service_eob.service_procedure_charge_amount.to_s.strip)%><%end%><%end%><%if  !service_eob.service_paid_amount.blank? or !service_eob.service_quantity.blank?%>*<% if !service_eob.service_paid_amount.blank?%><%= split_decimal( service_eob.service_paid_amount.to_s.strip)%><%end%><%end%><% if !service_eob.service_quantity.blank?%>**<%= split_decimal(service_eob.service_quantity.to_s.strip)%><%end%>~<% count=count+1%>
<%end%>
<% if !service_eob.date_of_service_from.blank? and !service_eob.date_of_service_to.blank? and (service_eob.date_of_service_from.to_s.strip!=service_eob.date_of_service_to.to_s.strip)%> 
DTM*150*<% if !service_eob.date_of_service_from.blank?%><%=service_eob.date_of_service_from.to_s.strip.split("-")%><%end%>~<% count=count+1%>
<%else%>
<% if (!service_eob.date_of_service_from.blank? and service_eob.date_of_service_to.blank?) or (!service_eob.date_of_service_from.blank? and (service_eob.date_of_service_from.to_s.strip==service_eob.date_of_service_to.to_s.strip))%> 
DTM*472*<% if !service_eob.date_of_service_from.blank?%><%=service_eob.date_of_service_from.to_s.strip.split("-")%><%end%>~<% count=count+1%>
<%end%>
<%end%>
<% if !service_eob.date_of_service_to.blank? and (service_eob.date_of_service_from.to_s.strip!=service_eob.date_of_service_to.to_s.strip)%>DTM*151*<%=service_eob.date_of_service_to.to_s.strip.split("-")%>~<% count=count+1%><%end%>
<%if (!service_eob.deductuble_groupcode.blank?  and  !service_eob.service_deductible.blank? and service_eob.service_deductible>0.0) or (!service_eob.copay_groupcode.blank?  and !service_eob.service_co_pay.blank? and service_eob.service_co_pay>0.0) or (!service_eob.coinsurance_groupcode.blank?  and !service_eob.service_co_insurance.blank? and service_eob.service_co_insurance>0.0 )%>
CAS*<%co_insurance=0%><%co_pay = 0%><%deducatble=0%><%if (!service_eob.coinsurance_groupcode.blank?) and (!service_eob.service_co_insurance.blank? and service_eob.service_co_insurance>0.0) %><%if !service_eob.coinsurance_groupcode.blank? and service_eob.coinsurance_groupcode.strip!=".." %><%=service_eob.coinsurance_groupcode.strip%><%else%>PR<%end%>*<%if !service_eob.coinsurance_code.blank?%><%=service_eob.coinsurance_code.strip%><%else%>2<%end%>*<%=split_decimal(service_eob.service_co_insurance.to_s.strip)%><%co_insurance=1%><%end%><%if (!service_eob.deductuble_groupcode.blank?  and  !service_eob.service_deductible.blank? and service_eob.service_deductible>0.0 )%><%if co_insurance==1%>**<%else%><%if !service_eob.deductuble_groupcode.blank? and service_eob.deductuble_groupcode.strip!=".." %><%=service_eob.deductuble_groupcode.strip%><%else%>PR<%end%>*<%end%><%if !service_eob.deductuble_code.blank?%><%=service_eob.deductuble_code.strip%><%else%>1<%end%>*<%=split_decimal(service_eob.service_deductible.to_s.strip)%><%deductable=1%><%end%><%if (!service_eob.copay_groupcode.blank?  and !service_eob.service_co_pay.blank? and service_eob.service_co_pay>0.0 ) %><%if co_insurance==1 or deducatble==1%>**<%else%><%if !service_eob.copay_groupcode.blank? and service_eob.copay_groupcode.strip!=".."%><%=service_eob.copay_groupcode.strip%><%else%>PR<%end%>*<%end%><%if !service_eob.copay_code.blank?%><%=service_eob.copay_code%><%else%>3<%end%>*<%=split_decimal(service_eob.service_co_pay.to_s.strip)%><%end%>~<%count=count+1%>
<%end%>
<%@cas_noncovered=""%><%@cas_discount=""%><%@cas_contractual=""%><%@cas_payment=""%><%@cas_primary_payment=""%>
<%if (!service_eob.charges_groupcode.blank? and service_eob.charges_groupcode.strip!=".." and !service_eob.charges_code.blank? and !service_eob.service_procedure_charge_amount.blank? and service_eob.service_procedure_charge_amount>0.0)or (!service_eob.noncovered_groupcode.blank? and service_eob.noncovered_groupcode.strip!=".." and !service_eob.noncovered_code.blank? and !service_eob.service_no_covered.blank? and service_eob.service_no_covered>0.0) or (!service_eob.discount_groupcode.blank? and service_eob.discount_groupcode.strip!=".." and  !service_eob.discount_code.blank? and !service_eob.service_discount.blank? and service_eob.service_discount>0.0) or (!service_eob.contractual_groupcode.blank? and service_eob.contractual_groupcode.strip!=".." and !service_eob.contractual_code.blank? and !service_eob.contractual_amount.blank? and service_eob.contractual_amount>0.0) or (!service_eob.payment_groupcode.blank? and service_eob.payment_groupcode.strip!=".." and !service_eob.payment_code.blank? and !service_eob.service_paid_amount.blank? and service_eob.service_paid_amount>0.0) or (!service_eob.primary_payment_groupcode.blank? and service_eob.primary_payment_groupcode.strip!=".." and !service_eob.primary_payment_code.blank? and !service_eob.service_submitted_charge_for_claim.blank? and service_eob.service_submitted_charge_for_claim>0.0) %>
<%charges=0%><%noncovered=0%><%discount=0%><%contractual=0%><%payment=0%><%primary_payment=0%>
<%if (!service_eob.charges_groupcode.blank? and service_eob.charges_groupcode.strip!=".." and !service_eob.charges_code.blank? and !service_eob.service_procedure_charge_amount.blank? and service_eob.service_procedure_charge_amount>0.0)%>CAS*<%=service_eob.charges_groupcode.strip%>*<%=service_eob.charges_code.strip%>*<%=split_decimal(service_eob.service_procedure_charge_amount.to_s.strip)%><%charges=1%><%end%><%if (!service_eob.noncovered_groupcode.blank? and service_eob.noncovered_groupcode.strip!=".." and !service_eob.noncovered_code.blank? and !service_eob.service_no_covered.blank? and service_eob.service_no_covered>0.0)%><%if charges==1 and service_eob.noncovered_groupcode==service_eob.charges_groupcode %>**<%=service_eob.noncovered_code%>*<%=split_decimal(service_eob.service_no_covered.to_s.strip)%><%noncovered=1%><%else%><%@cas_noncovered=service_eob.noncovered_groupcode.strip+"*"%><%@cas_noncovered+=service_eob.noncovered_code+"*"+split_decimal(service_eob.service_no_covered.to_s.strip)%><%end%><%end%><% if (!service_eob.discount_groupcode.blank? and service_eob.discount_groupcode.strip!=".." and  !service_eob.discount_code.blank? and !service_eob.service_discount.blank? and service_eob.service_discount>0.0) %><%if (charges==1 and service_eob.charges_groupcode==service_eob.discount_groupcode) or (noncovered==1)%>**<%=service_eob.discount_code.strip%>*<%=split_decimal(service_eob.service_discount.to_s.strip)%><%discount=1%><%else%><%@cas_discount=service_eob.discount_groupcode.strip+"*"%><%@cas_discount+=service_eob.discount_code.strip+"*"+split_decimal(service_eob.service_discount.to_s.strip)%><%end%><%end%><%if (!service_eob.contractual_groupcode.blank? and service_eob.contractual_groupcode.strip!=".." and !service_eob.contractual_code.blank? and !service_eob.contractual_amount.blank? and service_eob.contractual_amount>0.0) %><%if (charges==1 and service_eob.charges_groupcode==service_eob.contractual_groupcode) or noncovered==1 or discount==1 %>**<%=service_eob.contractual_code.strip%>*<%=split_decimal(service_eob.contractual_amount.to_s.strip)%><%contractual=1%><%else%><%@cas_contractual=service_eob.contractual_groupcode.strip+"*"%><%@cas_contractual+=service_eob.contractual_code.strip+"*"+split_decimal(service_eob.contractual_amount.to_s.strip)%><%end%><%end%><%if (!service_eob.payment_groupcode.blank? and service_eob.payment_groupcode.strip!=".." and !service_eob.payment_code.blank? and !service_eob.service_paid_amount.blank? and service_eob.service_paid_amount>0.0)%><%if (charges==1 and service_eob.charges_groupcode==service_eob.payment_groupcode) or noncovered==1 or discount==1 or contractual==1 %>**<%=service_eob.payment_code%>*<%=split_decimal(service_eob.service_paid_amount.to_s.strip)%><%payment=1%><%else%><%@cas_payment=service_eob.payment_groupcode.strip+"*"%><%@cas_payment+=service_eob.payment_code+"*"+split_decimal(service_eob.service_paid_amount.to_s.strip)%><%end%><%end%><%if (!service_eob.primary_payment_groupcode.blank? and service_eob.primary_payment_groupcode.strip!=".." and !service_eob.primary_payment_code.blank? and !service_eob.service_submitted_charge_for_claim.blank? and service_eob.service_submitted_charge_for_claim>0.0) %><%if (charges==1 and service_eob.charges_groupcode==service_eob.primary_payment_groupcode) or noncovered==1  or discount==1  or contractual==1  or payment==1 %>**<%=service_eob.primary_payment_code%>*<%=split_decimal(service_eob.service_submitted_charge_for_claim.to_s.strip)%><%else%><%@cas_primary_payment=service_eob.primary_payment_groupcode.strip+"*"%><%@cas_primary_payment+=service_eob.primary_payment_code+"*"+split_decimal(service_eob.service_submitted_charge_for_claim.to_s.strip)%><%end%><%end%><%if charges==1%>~<%count=count+1%><%end%>
<%end%>
<%if !@cas_noncovered.blank?%>CAS*<%= @cas_noncovered%>~<%count=count+1%><%end%>
<%if !@cas_discount.blank?%>CAS*<%= @cas_discount%>~<%count=count+1%><%end%>
<%if !@cas_contractual.blank?%>CAS*<%= @cas_contractual%>~<%count=count+1%><%end%>
<%if !@cas_payment.blank?%>CAS*<%=@cas_payment%>~<%count=count+1%><%end%>
<%if !@cas_primary_payment.blank?%>CAS*<%= @cas_primary_payment%>~<%count=count+1%><%end%>
<% if !service_eob.service_provider_control_number.blank?%>REF*6R*<%= service_eob.service_provider_control_number.to_s.strip%>~<% count=count+1%><%end%>
<% if !service_eob.service_provider_control_number.blank?%>REF*HPI*<%= service_eob.service_provider_control_number.to_s.strip%>~<% count=count+1%><%end%>
<%  if (!service_eob.service_allowable.blank? and service_eob.service_allowable>0)%>
AMT*B6<%if (!service_eob.service_allowable.blank? and service_eob.service_allowable>0)%>*<%= split_decimal(service_eob.service_allowable.to_s.strip)%><%end%>~<% count=count+1%>
<%end%>
<% if !service_eob.service_code_list_qualifier.blank? or !service_eob.service_industry_code.blank?%>
LQ*<% if !service_eob.service_code_list_qualifier.blank?%><%=service_eob.service_code_list_qualifier.to_s.strip%><%end%><% if !service_eob.service_industry_code.blank?%>*<%= service_eob.service_industry_code%><%end%>~<% count=count+1%>
<%end%>
<% if !ins_eob.provider_adjustment_amount.blank? and ins_eob.provider_adjustment_amount.to_i > 0 %>
<% if !service_eob.service_provider_number.blank? or !ins_eob.provider_date.blank? or !ins_eob.provider_adjustment_reason_code.blank? or !ins_eob.provider_adjustment_amount.blank?%>
<%if !service_eob.service_discount.blank? and service_eob.service_discount.to_f>0.0 %><%adjustment_reason_code = "90"%><%else%><%if !ins_eob.claim_interest.blank? and ins_eob.claim_interest>0 %><%adjustment_reason_code ="L6"%><%end%> <%end%>
PLB*<% if !ins_eob.rendering_provider_identification_number.blank?%><%= ins_eob.rendering_provider_identification_number.to_s.strip%><%end%><% if !ins_eob.provider_date.blank? or !ins_eob.provider_adjustment_reason_code.blank? or !ins_eob.provider_adjustment_amount.blank?%>*<% if !ins_eob.provider_date.blank?%>20081213<%end%><%end%><% if !ins_eob.provider_adjustment_reason_code.blank? or !ins_eob.provider_adjustment_amount.blank?%>*<%= adjustment_reason_code%><%end%><% if !ins_eob.provider_adjustment_amount.blank?%>*<%= split_decimal(ins_eob.provider_adjustment_amount.to_s.strip)%><%end%>~<%count=count+1%>
<%end%>
<%end%>
<%end%>
<%end%>
<%end%>
SE*<%= count+1%>*<%= sprintf("%04d", offset + i1 + 1) %>~
GE*<%= offset + i1 + 1 %>*2831~
IEA*1*<%= sprintf("%09d",id_835)%>~



